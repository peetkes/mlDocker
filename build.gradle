buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath "com.avast.gradle:gradle-docker-compose-plugin:0.10.4"
    }
}

plugins {
    // gradle -PenvironmentName=x ...
    id 'net.saliman.properties' version '1.4.6'
    id 'com.avast.gradle.docker-compose' version "0.10.4"
}

dockerCompose {
    useComposeFiles = [dockerComposeFiles]
    waitForTcpPorts = false
    stopContainers = true // doesn't call `docker-compose down` if set to false - see below the paragraph about reconnecting; default is true
    removeContainers = false // default is true
}

task mlDockerSetupNode(dependsOn:composeUp)  {
  doLast {
    sleep(5 * 1000) //ensure node is up
    exec {
      commandLine 'docker', 'exec', dockerInstance, 'init-marklogic' 
    }
  }
}

task mlDockerStart(dependsOn:composeUp)

task mlDockerStop(dependsOn:composeDown)

task mlDockerTeardown(type: Delete, dependsOn:composeDown) {
  //remove logs directory
  delete 'logs'
}